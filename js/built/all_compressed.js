function async(your_function,callback){setTimeout(function(){your_function(),callback&&callback()},0)}function listenClick(id,fn){document.getElementById(id).addEventListener("click",fn)}function doOptionsCheckBox(e){"INPUT"===e.target.nodeName&&editMenuForm.doSpecialCheckBox(e.target.parentElement)}function hideElements(className){for(var blocks=document.getElementsByClassName(className),i=0;i<blocks.length;i++)blocks[i].style.display="none"}function spread(){var out=[];out=[].concat.apply([],arguments[0]);for(var i=1;i<arguments.length;i++)out=[].concat.apply(out,arguments[i]);return out}function getServerHostForEnv(){return null!==window.location.href.match(/^http:\/\/localhost:(3000|8080).*$/)?"http://localhost:8080":"https://catnipcdn.pagekite.me"}function microTime(){return 1e3*new Date}function getXHRCallable(){var xmlHttp;if(window.XMLHttpRequest)xmlHttp=new XMLHttpRequest;else{if(!window.ActiveXObject)throw console.log("no way to XMLHttpRequest, giving up"),alert("don't know how internet works HTTP anymore?????"),new Error("don't know how internet works HTTP anymore?????");xmlHttp=new ActiveXObject("Microsoft.XMLHTTP")}return xmlHttp}function httpGetAsync(theUrl,callback,failfun){var xmlHttp=getXHRCallable();xmlHttp.open("GET",theUrl,!0),xmlHttp.onreadystatechange=function(){4===xmlHttp.readyState&&(200===xmlHttp.status?callback(xmlHttp.responseText):failfun(xmlHttp,theUrl))},xmlHttp.send(null)}function httpPostAsync(theUrl,callback,failfun,data){var xmlHttp=getXHRCallable();xmlHttp.open("POST",theUrl,!0),xmlHttp.setRequestHeader("Content-Type","application/json"),xmlHttp.onreadystatechange=function(){4===xmlHttp.readyState&&(200===xmlHttp.status?callback(xmlHttp.responseText):failfun(xmlHttp,theUrl))},xmlHttp.send(data)}function onSignIn(googleUser){console.log("clicked sign in"),(currentGoogleUser={}).vendor=googleUser,currentGoogleUser.reload=googleUser.reloadAuthResponse;var id_token=googleUser.getAuthResponse().id_token;httpPostAsync(getServerHostForEnv(),function(response){var info=JSON.parse(response);console.log(info),anticsrf=info.data.anticsrf,currentGoogleUser.nih_info=info.data.gapi_info,afterGLoginWriter()},function(url,req){console.log("failed "+req)},JSON.stringify(defaultJSONObjs.initial_gapi_validate(id_token)))}function renderButton(){gapi.signin2.render("glogin",{scope:"profile email",width:400,height:100,longtitle:!0,theme:"dark",onsuccess:onSignIn,onfailure:function(error){console.log(error)}})}function doSignOut(){confirm("Are you sure you would like to sign out of Mineral Springs?")&&(removeChildren(document.getElementById("buttonWrapper")),signOut(),window.location.reload())}function signOut(){gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out.")})}function removeChildren(elt){for(;elt.firstChild;)elt.removeChild(elt.firstChild)}function loadContent(page){viewIsHome=!1,hideElements("block");var pname="views/"+page+".html";httpGetAsync(pname,function(response){var inject=response;btnwrp=document.getElementById("buttonWrapper"),removeChildren(btnwrp),btnwrp.insertAdjacentHTML("beforeend",inject),"forms/menu"===page&&document.getElementById("default-special-checkbox").addEventListener("click",function(e){"INPUT"===e.target.nodeName&&editMenuForm.doSpecialCheckBox(e.target.parentElement)})},function(url,req){console.log("failed to inject "+pname)})}function afterGLoginWriter(){async(function(){for(var elems=[document.getElementById("googleSignInWrapper"),document.getElementById("bigcircle")],i=0;i<elems.length;i++){var e=elems[i];e&&e.parentNode.removeChild(e)}},async(mainPageLoader,function(){var probutton=document.getElementById("profileButton");probutton.style.backgroundImage="url("+currentGoogleUser.nih_info.picture+")",probutton.style.display="inline-block"}))}function mainPageLoader(){if(!viewIsHome){viewIsHome=!0;var fnames=["big2"];fnames.push(["user","admin"][+((currentGoogleUser||{}).nih_info||{}).is_elevated||0]),removeChildren(document.getElementById("buttonWrapper"));for(var i=0;i<fnames.length;i++){var abspath="views/btns/"+fnames[i]+".html";httpGetAsync(abspath,function(response){document.getElementById("buttonWrapper").insertAdjacentHTML("beforeend",response)},function(url,req){console.log("failed to inject elt "+abspath)})}}}function showGLogin(){var circle=document.getElementById("bigcircle");circle.parentNode.removeChild(circle),document.getElementById("googleSignInWrapper").style.display="inline-block"}function initialLoader(){httpGetAsync("views/btns/bigcircle.html",function(response){document.getElementById("buttonWrapper").insertAdjacentHTML("beforeend",response)},function(url,req){console.log("failed to inject elt "+abspath)})}function enableBigButton(){document.getElementById("bigcircle").addEventListener("click",showGLogin),document.getElementById("c_bigtext").innerHTML="Login to Google",document.getElementById("c_liltext").innerHTML="login to use this app"}function checkGoogleAuthVerificationExists(){httpGetAsync("googlebb7e3fa23640d3b2.html",googleAPIFile.ok,googleAPIFile.err)}function writeConnTimeStats(time){var diff=Math.abs(time.conn_init-time.conn_finish);console.log("connection to the CDN took "+(diff/Math.pow(10,3)).toString()+"msec")}function checkCatnipCDNStatusOk(){httpPostAsync(getServerHostForEnv(),catnipCDNUp.ok,catnipCDNUp.err,JSON.stringify(defaultJSONObjs.ping))}function haveJS(){console.log("have JS (duh)");var alert=document.getElementById("alert");alert.parentNode.removeChild(alert)}function firstLoader(){haveJS(),async(initialLoader,function(){async(checkGoogleAuthVerificationExists,checkCatnipCDNStatusOk)})}function doLoadingIconToggle(state,name){console.log("loading "+(state?"on":"off")+" caller: "+name),document.getElementById("loading").style.display=state?"inline-block":"none"}function callLoader(fun){doLoadingIconToggle(!0,fun.name),fun(),doLoadingIconToggle(!1,fun.name)}function testFormsOffline(elv){currentGoogleUser={nih_info:{is_elevated:elv}},afterGLoginWriter()}googleAPIFile={ok:function(response){var elt=document.getElementById("google-auth-check");"google-site-verification: googlebb7e3fa23640d3b2.html"===response?(elt.style.color="green",elt.innerHTML+=" OK"):(console.log("auth no good"),elt.style.color="red",elt.innerHTML+=" missing")},err:function(url,resp){var elt=document.getElementById("google-auth-check");console.log("failed to GET "+url+" returned "+resp.status.toString()),console.log("auth no good"),elt.style.color="red",elt.innerHTML+=" missing"}},catnipCDNUp={ok:function(response){var rsp=JSON.parse(response),elt=document.getElementById("cdn-api-check");rsp.time.conn_finish=microTime(),"reply_ping"===rsp.response&&!0===rsp.data.pingback?(enableBigButton(),console.log("catnip ok"),writeConnTimeStats(rsp.time),elt.style.color="green",elt.innerHTML+=" OK"):catnipCDNUp.cdn_no_good()},err:function(url,resp){catnipCDNUp.cdn_no_good()},cdn_no_good:function(){console.log("catnip no good");var elt=document.getElementById("cdn-api-check");elt.style.color="red",elt.innerHTML+=" missing",document.getElementById("bigcircle").addEventListener("mousedown",function(){alert("Sorry, your request cannot be processed, because the server ("+getServerHostForEnv()+") is down for maintenance. Try again later.")})}},defaultJSONObjs={ping:{verb:"ping",data:{ping:"hello"},time:{conn_init:microTime()}},initial_gapi_validate:function(tok){return{verb:"gapi_validate",data:{gapi_key:tok},time:{conn_init:microTime()}}},view_menu:function(){return{verb:"view_menu",data:{},time:{conn_init:microTime()},anticsrf:anticsrf.tok||""}}};var currentGoogleUser=null,viewIsHome=!1,anticsrf={};is_buffet=!1;var editMenuForm={formResizer:{counter:1,_getLastFieldSet:function(){var fields=document.getElementsByTagName("fieldset");return fields.item(fields.length-1)},addItem:function(){var newname="field-"+editMenuForm.formResizer.counter,newfield='<fieldset class="menu-field" id="'+newname+'" name="'+newname+'">\n';newfield+='<label class="menu-itemname"> Item name:<input class="menu-itemname-input" type="text" name="'+newname+'-name" value=""/></label><label class="menu-itemdesc"> Description:<textarea class="menu-itemdesc-input" type="text" name="'+newname+'-desc" value=""/></textarea></label><label class="menu-itemprice" style="display: '+(is_buffet?"none":"inline")+';">Price:<input class="menu-itemprice-input" type="number" name="'+newname+'-price" value="" /></label><label class="menu-itemoptions" id="'+newname+'-special-checkbox">Options?<input class="menu-itemoptions-input" type="checkbox" name="'+newname+'-options" value=""/></label>',newfield+='<button type="button" onclick="editMenuForm.formResizer.removeItem('+editMenuForm.formResizer.counter+');">Remove this item</button>\n',newfield+="</fieldset>",document.getElementById("menu-form").insertAdjacentHTML("beforeend",newfield),++editMenuForm.formResizer.counter,document.getElementById(newname+"-special-checkbox").addEventListener("click",function(e){"INPUT"===e.target.nodeName&&editMenuForm.doSpecialCheckBox(e.target.parentElement)})},removeLast:function(){var lastfield=editMenuForm.formResizer._getLastFieldSet();null===lastfield||lastfield.id.match(/default/)?editMenuForm.formResizer.counter=1:lastfield.parentNode.removeChild(lastfield)},removeItem:function(n){if(--editMenuForm.formResizer.counter,0!==n){var elem=document.getElementById("field-"+n);elem.parentNode.removeChild(elem)}}},formExtract:function(name){for(var all_items={},top_forms=document.getElementsByTagName("fieldset"),j=0;j<top_forms.length;j++){for(var local_result={},fs=top_forms[j],need_tags=spread(fs.getElementsByTagName("input"),fs.getElementsByTagName("textarea")),i=0;i<need_tags.length;i++){var intag=need_tags[i],val="checkbox"===intag.type?intag.checked:intag.value;local_result[intag.name]=val}all_items[fs.id]=local_result}all_items.is_buffet=document.getElementById("is_buffet").checked,console.log(all_items)},doSpecialCheckBox:function(label){for(var cbox=label.getElementsByTagName("input")[0],checked=cbox.checked,topfield=label.parentElement,optform='<fieldset class="options-field" name="'+cbox.name+'-fieldset" id="'+cbox.name+'-fieldset">',i=0;i<3;i++)optform+="<label class='options-name'>Name:<input type='text' name='"+cbox.name+"-options"+i+"-name'/></label>",is_buffet||(optform+="<label class='options-price'>Price:<input type='number' name='"+cbox.name+"-options"+i+"-price'/></label>"),optform+="<br>\n";if(optform+="</fieldset>",checked)topfield.insertAdjacentHTML("beforeend",optform);else{var optfs_name=cbox.name+"-fieldset",optfs=document.getElementById(optfs_name);optfs.parentElement.removeChild(optfs)}},doBuffetBox:function(){var checked=document.getElementById("is_buffet").checked;is_buffet=checked;var warn=document.getElementById("buffet_warn");checked?warn.removeAttribute("hidden"):warn.setAttribute("hidden",!0);for(var inputs=document.getElementsByTagName("input"),j=0;j<inputs.length;j++){var ip=inputs[j];ip.name.match(/price$/)&&(ip.parentNode.style.display=checked?"none":"inline")}}};