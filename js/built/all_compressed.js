function async(e,n){setTimeout(function(){e(),n&&n()},0)}function listenClick(e,n){document.getElementById(e).addEventListener("click",n)}function doOptionsCheckBox(e){"INPUT"===e.target.nodeName&&editMenuForm.doSpecialCheckBox(e.target.parentElement)}function hideElements(e){for(var n=document.getElementsByClassName(e),t=0;t<n.length;t++)n[t].style.display="none"}function getServerHostForEnv(){return null!==window.location.href.match(/^http:\/\/localhost:(3000|8080).*$/)?"http://localhost:8080":"https://catnipcdn.pagekite.me"}function microTime(){return 1e3*new Date}function getXHRCallable(){var e;if(window.XMLHttpRequest)e=new XMLHttpRequest;else{if(!window.ActiveXObject)throw console.log("no way to XMLHttpRequest, giving up"),new Error("don't know how internet works HTTP anymore?????");e=new ActiveXObject("Microsoft.XMLHTTP")}return e}function httpGetAsync(e,n,t){var o=getXHRCallable();o.open("GET",e,!0),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?n(o.responseText):t(o,e))},o.send(null)}function httpPostAsync(e,n,t,o){var i=getXHRCallable();i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?n(i.responseText):t(i,e))},i.send(o)}function onSignIn(e){console.log("clicked sign in"),(currentGoogleUser={}).vendor=e,currentGoogleUser.reload=e.reloadAuthResponse;var n=e.getAuthResponse().id_token;httpPostAsync(getServerHostForEnv(),function(e){var n=JSON.parse(e);console.log(n),anticsrf=n.data.anticsrf,currentGoogleUser.nih_info=n.data.gapi_info,afterGLoginWriter()},function(e,n){console.log("failed "+n)},JSON.stringify(defaultJSONObjs.initial_gapi_validate(n)))}function renderButton(){gapi.signin2.render("glogin",{scope:"profile email",width:400,height:100,longtitle:!0,theme:"dark",onsuccess:onSignIn,onfailure:function(e){console.log(e)}})}function doSignOut(){confirm("Are you sure you would like to sign out of Mineral Springs?")&&(removeChildren(document.getElementById("buttonWrapper")),signOut(),window.location.reload())}function signOut(){gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out.")})}function removeChildren(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function loadContent(e){viewIsHome=!1,hideElements("block");var n="views/"+e+".html";httpGetAsync(n,function(n){var t=n;btnwrp=document.getElementById("buttonWrapper"),removeChildren(btnwrp),btnwrp.insertAdjacentHTML("beforeend",t),"forms/menu"===e&&document.getElementById("default-special-checkbox").addEventListener("click",function(e){"INPUT"===e.target.nodeName&&editMenuForm.doSpecialCheckBox(e.target.parentElement)})},function(e,t){console.log("failed to inject "+n)})}function afterGLoginWriter(){async(function(){for(var e=[document.getElementById("googleSignInWrapper"),document.getElementById("bigcircle")],n=0;n<e.length;n++){var t=e[n];t&&t.parentNode.removeChild(t)}},async(mainPageLoader,function(){var e=document.getElementById("profileButton");e.style.backgroundImage="url("+currentGoogleUser.nih_info.picture+")",e.style.display="inline-block"}))}function mainPageLoader(){if(!viewIsHome){viewIsHome=!0;var e=["big2"];e.push(["user","admin"][+((currentGoogleUser||{}).nih_info||{}).is_elevated||0]),removeChildren(document.getElementById("buttonWrapper"));for(var n=0;n<e.length;n++){var t="views/btns/"+e[n]+".html";httpGetAsync(t,function(e){document.getElementById("buttonWrapper").insertAdjacentHTML("beforeend",e)},function(e,n){console.log("failed to inject elt "+t)})}}}function showGLogin(){var e=document.getElementById("bigcircle");e.parentNode.removeChild(e),document.getElementById("googleSignInWrapper").style.display="inline-block"}function initialLoader(){httpGetAsync("views/btns/bigcircle.html",function(e){document.getElementById("buttonWrapper").insertAdjacentHTML("beforeend",e)},function(e,n){console.log("failed to inject elt "+abspath)})}function enableBigButton(){document.getElementById("bigcircle").addEventListener("click",showGLogin),document.getElementById("c_bigtext").innerHTML="Login to Google",document.getElementById("c_liltext").innerHTML="login to use this app"}function checkGoogleAuthVerificationExists(){httpGetAsync("googlebb7e3fa23640d3b2.html",googleAPIFile.ok,googleAPIFile.err)}function writeConnTimeStats(e){var n=Math.abs(e.conn_init-e.conn_finish);console.log("connection to the CDN took "+(n/Math.pow(10,3)).toString()+"msec")}function checkCatnipCDNStatusOk(){httpPostAsync(getServerHostForEnv(),catnipCDNUp.ok,catnipCDNUp.err,JSON.stringify(defaultJSONObjs.ping))}function haveJS(){console.log("have JS (duh)");var e=document.getElementById("alert");e.parentNode.removeChild(e)}function firstLoader(){haveJS(),async(initialLoader,function(){async(checkGoogleAuthVerificationExists,checkCatnipCDNStatusOk)})}function doLoadingIconToggle(e,n){console.log("loading "+(e?"on":"off")+" caller: "+n),document.getElementById("loading").style.display=e?"inline-block":"none"}function callLoader(e){doLoadingIconToggle(!0,e.name),e(),doLoadingIconToggle(!1,e.name)}function testFormsOffline(e){currentGoogleUser={nih_info:{is_elevated:e}},afterGLoginWriter()}googleAPIFile={ok:function(e){var n=document.getElementById("google-auth-check");"google-site-verification: googlebb7e3fa23640d3b2.html"===e?(n.style.color="green",n.innerHTML+=" OK"):(console.log("auth no good"),n.style.color="red",n.innerHTML+=" missing")},err:function(e,n){var t=document.getElementById("google-auth-check");console.log("failed to GET "+e+" returned "+n.status.toString()),console.log("auth no good"),t.style.color="red",t.innerHTML+=" missing"}},catnipCDNUp={ok:function(e){var n=JSON.parse(e),t=document.getElementById("cdn-api-check");n.time.conn_finish=microTime(),"reply_ping"===n.response&&!0===n.data.pingback?(enableBigButton(),console.log("catnip ok"),writeConnTimeStats(n.time),t.style.color="green",t.innerHTML+=" OK"):catnipCDNUp.cdn_no_good()},err:function(e,n){catnipCDNUp.cdn_no_good()},cdn_no_good:function(){console.log("catnip no good");var e=document.getElementById("cdn-api-check");e.style.color="red",e.innerHTML+=" missing",document.getElementById("bigcircle").addEventListener("mousedown",function(){alert("Sorry, your request cannot be processed, because the server ("+getServerHostForEnv()+") is down for maintenance. Try again later.")})}},defaultJSONObjs={ping:{verb:"ping",data:{ping:"hello"},time:{conn_init:microTime()}},initial_gapi_validate:function(e){return{verb:"gapi_validate",data:{gapi_key:e},time:{conn_init:microTime()}}},view_menu:function(){return{verb:"view_menu",data:{},time:{conn_init:microTime()},anticsrf:anticsrf.tok||""}}};var currentGoogleUser=null,viewIsHome=!1,anticsrf={};is_buffet=!1;var editMenuForm={formResizer:{counter:1,_getLastFieldSet:function(){var e=document.getElementsByTagName("fieldset");return e.item(e.length-1)},addItem:function(){var e="field-"+editMenuForm.formResizer.counter,n='<fieldset class="menu-field" id="'+e+'" name="'+e+'">\n';n+='<label class="menu-itemname"> Item name:<input class="menu-itemname-input" type="text" name="'+e+'-name" value=""/></label><label class="menu-itemdesc"> Description:<textarea class="menu-itemdesc-input" type="text" name="'+e+'-desc" value=""/></textarea></label><label class="menu-itemprice" style="display: '+(is_buffet?"none":"inline")+';">Price:<input class="menu-itemprice-input" type="number" name="'+e+'-price" value="" /></label><label class="menu-itemoptions" id="'+e+'-special-checkbox">Options?<input class="menu-itemoptions-input" type="checkbox" name="'+e+'-options" value=""/></label>',n+='<button type="button" onclick="editMenuForm.formResizer.removeItem('+editMenuForm.formResizer.counter+');">Remove this item</button>\n',n+="</fieldset>",document.getElementById("menu-form").insertAdjacentHTML("beforeend",n),++editMenuForm.formResizer.counter,document.getElementById(e+"-special-checkbox").addEventListener("click",function(e){"INPUT"===e.target.nodeName&&editMenuForm.doSpecialCheckBox(e.target.parentElement)})},removeLast:function(){var e=editMenuForm.formResizer._getLastFieldSet();null===e||e.id.match(/default/)?editMenuForm.formResizer.counter=1:e.parentNode.removeChild(e)},removeItem:function(e){if(--editMenuForm.formResizer.counter,0!==e){var n=document.getElementById("field-"+e);n.parentNode.removeChild(n)}}},formExtract:function(e){for(var n={},t=document.getElementsByTagName("fieldset"),o=0;o<t.length;o++){for(var i=t[c],r={},a=Object.assign({},i.getElementsByTagName("input"),i.getElementsByTagName("textarea")),c=0;c<a.length;c++){var l=a[c],s="checkbox"===l.type?l.checked:l.value;nme=l.name,r[nme]=s}n[i.id]=r}n.is_buffet=document.getElementById("is_buffet").checked,console.log(n)},doSpecialCheckBox:function(e){for(var n=e.getElementsByTagName("input")[0],t=n.checked,o=e.parentElement,i='<fieldset class="options-field" name="'+n.name+'-fieldset" id="'+n.name+'-fieldset">',r=0;r<3;r++)i+="<label class='options-name'>Name:<input type='text' name='"+n.name+"-options"+r+"-name'/></label>",is_buffet||(i+="<label class='options-price'>Price:<input type='number' name='"+n.name+"-options"+r+"-price'/></label>"),i+="<br>\n";if(i+="</fieldset>",t)o.insertAdjacentHTML("beforeend",i);else{var a=n.name+"-fieldset",c=document.getElementById(a);c.parentElement.removeChild(c)}},doBuffetBox:function(){var e=document.getElementById("is_buffet").checked;is_buffet=e;var n=document.getElementById("buffet_warn");e?n.removeAttribute("hidden"):n.setAttribute("hidden",!0);for(var t=document.getElementsByTagName("input"),o=0;o<t.length;o++){var i=t[o];i.name.match(/price$/)&&(i.parentNode.style.display=e?"none":"inline")}}};